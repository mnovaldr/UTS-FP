{% extends 'perpustakaan/base.html' %}

{% block title %}Detail Peminjaman - ID {{ peminjaman.id }}{% endblock %}

{% block content %}
<div class="card">
    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 2rem;">
        <div>
            <h1>Detail Peminjaman</h1>
            <p style="color: #718096; margin-top: 0.5rem;">Informasi lengkap transaksi peminjaman buku</p>
        </div>
        <div>
            <a href="{% url 'peminjaman-edit' peminjaman.pk %}" class="btn btn-warning">Edit</a>
            <a href="{% url 'peminjaman-hapus' peminjaman.pk %}" class="btn btn-danger">Hapus</a>
            <a href="{% url 'peminjaman-list' %}" class="btn btn-primary">Kembali</a>
        </div>
    </div>

    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
        <div>
            <h3 style="margin-bottom: 1rem; color: #2d3748;">Informasi Peminjaman</h3>
            
            <div style="margin-bottom: 1rem;">
                <label style="font-weight: 600; display: block; margin-bottom: 0.25rem;">ID Peminjaman</label>
                <div id="p-id" style="padding: 0.75rem; background: #f8fafc; border-radius: 6px; font-family: monospace;">Loading...</div>
            </div>

            <div style="margin-bottom: 1rem;">
                <label style="font-weight: 600; display: block; margin-bottom: 0.25rem;">Status Peminjaman</label>
                <div id="p-status" style="padding: 0.75rem; border-radius: 6px; font-weight: 600;">Loading...</div>
            </div>

            <div style="margin-bottom: 1rem;">
                <label style="font-weight: 600; display: block; margin-bottom: 0.25rem;">Tanggal Pinjam</label>
                <div id="p-tgl-pinjam" style="padding: 0.75rem; background: #f8fafc; border-radius: 6px;">Loading...</div>
            </div>

            <div style="margin-bottom: 1rem;">
                <label style="font-weight: 600; display: block; margin-bottom: 0.25rem;">Tanggal Harus Kembali</label>
                <div id="p-tgl-kembali" style="padding: 0.75rem; border-radius: 6px;">
                    Loading...
                </div>
            </div>
        </div>

        <div>
            <h3 style="margin-bottom: 1rem; color: #2d3748;">Detail & Status</h3>

            <div style="margin-bottom: 1rem;">
                <label style="font-weight: 600; display: block; margin-bottom: 0.25rem;">Tanggal Dikembalikan</label>
                <div id="p-tgl-dikembalikan" style="padding: 0.75rem; border-radius: 6px;">Loading...</div>
            </div>

            <div style="margin-bottom: 1rem;">
                <label style="font-weight: 600; display: block; margin-bottom: 0.25rem;">Denda</label>
                <div id="p-denda" style="padding: 0.75rem; border-radius: 6px;">Loading...</div>
            </div>

            <div style="margin-bottom: 1rem;">
                <label style="font-weight: 600; display: block; margin-bottom: 0.25rem;">Peminjam</label>
                <div style="padding: 0.75rem; background: #f8fafc; border-radius: 6px;">
                    <a id="link-anggota" href="#" 
                       style="color: #2b6cb0; font-weight: 600; text-decoration: none; display: block;">
                        Loading...
                    </a>
                    <small id="nomor-anggota" style="color: #718096;"></small>
                </div>
            </div>

            <div style="margin-bottom: 1rem;">
                <label style="font-weight: 600; display: block; margin-bottom: 0.25rem;">Buku</label>
                <div style="padding: 0.75rem; background: #f8fafc; border-radius: 6px;">
                    <a id="link-buku" href="#" 
                       style="color: #2b6cb0; font-weight: 600; text-decoration: none; display: block;">
                        Loading...
                    </a>
                    <small id="isbn-buku" style="color: #718096;"></small>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    fetch(`/api/peminjaman/{{ peminjaman.id }}/`).then(r=>r.json()).then(d=>{
        document.getElementById('p-id').textContent = d.id;
        
        const statusEl = document.getElementById('p-status');
        statusEl.textContent = d.status_display;
        // Simple styling logic
        if(d.status === 'DIKEMBALIKAN') statusEl.style.background = '#f0fff4';
        else if(d.status === 'TERLAMBAT') statusEl.style.background = '#fff5f5';
        else statusEl.style.background = '#fffaf0';

        const opts = {weekday:'long', day:'numeric', month:'long', year:'numeric'};
        document.getElementById('p-tgl-pinjam').textContent = new Date(d.tanggal_pinjam).toLocaleDateString('id-ID', opts);
        document.getElementById('p-tgl-kembali').textContent = new Date(d.tanggal_kembali).toLocaleDateString('id-ID', opts);
        
        document.getElementById('p-tgl-dikembalikan').textContent = d.tanggal_dikembalikan ? new Date(d.tanggal_dikembalikan).toLocaleDateString('id-ID', opts) : 'Belum dikembalikan';
        document.getElementById('p-denda').textContent = 'Rp ' + d.denda;

        const linkAnggota = document.getElementById('link-anggota');
        linkAnggota.textContent = d.anggota_nama;
        linkAnggota.href = `/perpustakaan/anggota/${d.anggota}/`;
        document.getElementById('nomor-anggota').textContent = d.anggota_nomor;

        const linkBuku = document.getElementById('link-buku');
        linkBuku.textContent = d.buku_judul;
        linkBuku.href = `/perpustakaan/buku/${d.buku}/`;
        document.getElementById('isbn-buku').textContent = d.buku_isbn;
    });
</script>
{% endblock %}